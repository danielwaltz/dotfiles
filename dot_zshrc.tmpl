{{- if eq .chezmoi.os "darwin" }}
# Kiro CLI pre block. Keep at the top of this file.
[[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.pre.zsh"
{{- end }}

### antidote
source ~/.local/share/antidote/antidote.zsh
antidote load

if [[ -o interactive ]]; then
  fastfetch
fi

### aliases
function update() {
  echo '\e[32m\ue5fc chezmoi'
  chezmoi update

  echo '\e[32m\ue795 antidote'
  antidote update

  {{- if eq .chezmoi.os "linux" }}
  if command -v apt &> /dev/null; then
    echo '\e[32m\ue77d apt'
    sudo apt update && sudo apt upgrade
  fi

  if command -v dnf &> /dev/null; then
    echo '\e[32m\ue7d9 dnf'
    sudo dnf upgrade
  fi

  if command -v pacman &> /dev/null; then
    if command -v paru &> /dev/null; then
      echo '\e[32m\ue732 paru'
      paru -Syu
    else
      echo '\e[32m\ue732 pacman'
      sudo pacman -Syu
    fi
  fi

  if command -v flatpak &> /dev/null; then
    echo '\e[32m\uf1b2 flatpak'
    flatpak update -y
  fi
  {{- end }}

  {{- if eq .chezmoi.os "darwin" }}
  if command -v brew &> /dev/null; then
    echo '\e[32m\uf0fc brew'
    brew update && brew upgrade && brew upgrade --cask
  fi

  if command -v mas &> /dev/null; then
    echo '\e[32m\ue711 mas'
    mas upgrade
  fi
  {{- end }}

  echo '\e[32m\uf1b2 mise'
  mise plugins update && mise upgrade
}
function cleanup() {
  {{- if eq .chezmoi.os "linux" }}
  if command -v apt &> /dev/null; then
    echo '\e[32m\ue77d apt'
    sudo apt autoremove --purge
  fi

  if command -v dnf &> /dev/null; then
    echo '\e[32m\uf308 dnf'
    sudo dnf autoremove
  fi

  if command -v pacman &> /dev/null; then
    if command -v paru &> /dev/null; then
      echo '\e[32m\ue732 paru'
      paru -Rsn $(paru -Qtdq)
    else
      echo '\e[32m\uf303 pacman'
      sudo pacman -Rns $(pacman -Qtdq)
    fi

    paccache -r
  fi
  {{- end }}

  {{- if eq .chezmoi.os "darwin" }}
  echo '\e[32m\uf0fc brew'
  brew cleanup
  {{- end }}

  echo '\e[32m\uf1b2 mise'
  mise prune
}
alias -- bump='bunx taze@latest -rwiI'
alias -- bumpall='bunx taze@latest major -rwiu && git commit -am "chore: update deps"'
alias -- c='clear'
alias -- dotfiles='chezmoi edit'
alias -- ls='eza -al --color=always --group-directories-first --icons=always' # preferred listing
alias -- la='eza -a --color=always --group-directories-first --icons=always'  # all files and dirs
alias -- ll='eza -l --color=always --group-directories-first --icons=always'  # long format
alias -- lt='eza -aT --color=always --group-directories-first --icons=always' # tree listing
alias -- l.="eza -a | grep -e '^\.'"                                          # show only dotfiles
alias -- lint='bunx oxlint@latest --tsconfig tsconfig.json --import-plugin --jsdoc-plugin --vitest-plugin --react-perf-plugin --promise-plugin --node-plugin'
alias -- pretty='bunx prettier@latest --write --ignore-unknown -- "**/*" "!**/package-lock.json" "!**/yarn.lock" "!**/pnpm-lock.yaml" "!**/bun.lock" "!**/deno.lock" "!**/dist/**" "!**/.output/**" "!**/build/**" "!**/out/**"'
alias -- rmlock='rm -rf **/node_modules(N) **/package-lock.json(N) **/yarn.lock(N) **/pnpm-lock.yaml(N) **/bun.lock(N) **/bun.lockb(N) **/deno.lock(N)'
alias -- rmdist='rm -rf **/dist(N) **/.output(N) **/build(N) **/out(N)'
alias -- src='chezmoi apply && source ~/.zshrc'
{{- if eq .chezmoi.os "darwin" }}
alias -- spacer='defaults write com.apple.dock persistent-apps -array-add '"'"'{tile-type=\"spacer-tile\";}'"'"' && killall Dock'
alias -- spacermini='defaults write com.apple.dock persistent-apps -array-add '"'"'{tile-type=\"small-spacer-tile\";}'"'"' && killall Dock'
alias -- dsdestroy='find . -name '"'"'*.DS_Store'"'"' -type f -ls -delete'
{{- end }}

### init
if command -v starship &> /dev/null; then
  eval "$(starship init zsh)"
fi
if command -v keychain &> /dev/null; then
  eval "$(keychain --eval --quiet)"
fi
export EDITOR="code -nw"
export OS="`uname`"
export GPG_TTY=$(tty)
export PROMPT_COMMAND="history -a; $PROMPT_COMMAND"
[[ -n $GHOSTTY_RESOURCES_DIR ]] && source "$GHOSTTY_RESOURCES_DIR"/shell-integration/zsh/ghostty-integration
[[ "$TERM_PROGRAM" == "vscode" ]] && . "$(code --locate-shell-integration-path zsh)"

{{- if eq .chezmoi.os "darwin" }}
# Kiro CLI post block. Keep at the bottom of this file.
[[ -f "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh" ]] && builtin source "${HOME}/Library/Application Support/kiro-cli/shell/zshrc.post.zsh"
{{- end }}
